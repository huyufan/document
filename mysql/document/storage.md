# innodb 数据存在哪个文件下面
``` mysql
show variables like 'datadir'
```

## db.opt
- 用来存储当前数据库的默认字符集 和字符校验规则


## test.frm
- 用来保存每个表的云数据信息的,注意包含表结构定义

## test.idb
- 存表数据 表数据可以存在共享表空间文件(ibdata1)里,也可以存在独占表空间文件（文件名 表.idb）参数有innodb_file_per_table  控制 5.6.6 默认为On 存在独立的文件了


# 表空间文件的结构
- 表空间有段(segment) 区(extent) 页(page) 行(row)

## 行
- 数据库表中都是按行来存放的

## 页
- 记录时安装行来存储的，但是数据库读取不是按[行]为单位，否则一次读取(一次I/O操作)只能处理一行 效率低下
- 因此  INNODB的数据是按[页]为单位来读写的
- 默认每个页是16k

## 区
- B+树中每一层都是通过双向链表连接起来的，如果是以页来分配存储空间的话 那么链表中相邻的两个页之间的物理位置并不是连续的，可能离得非常远，那么磁盘查询时就会有大量的随机I/O，随机 I/O 是非常慢的。
- 在表中数据量大的时候，为某个索引分配空间的时候就不再按照页为单位分配了，而是按照区（extent）为单位分配。每个区的大小为 1MB，对于  16KB 的页来说，连续的 64 个页会被划为一个区，这样就使得链表中相邻的页的物理位置也相邻，就能使用顺序 I/O 了

## 段
### 表空间是由各个段（segment）组成的，段是由多个区（extent）组成的。段一般分为数据段、索引段和回滚段等。
- 索引段  存放 B + 树的非叶子节点的区的集合
- 数据段   存放 B + 树的叶子节点的区的集合
- 回滚段 存放的是回滚数据的区的集合   MVCC 利用了回滚段实现了多版本查询数据

### 行格式（row_format)
- 4种格式 Redundant Compact Dynamic Compressed

### Compact  记录额外的信息  和 真实数据

#### 记录额外的信息  变长字段长度列表  NULL值列表  记录头信息

##### 变长字段长度列表
- varchar(n) 和char(n) char  固定的  varchar 是变长的 变成字段实际存储的数据的长度（大小）不固定
- 当数据表没有变长字段的时候，比如全部都是 int 类型的字段，这时候表里的行格式就不会有「变长字段长度列表」了 所以「变长字段长度列表」只出现在数据表有变长字段的时候。

#### NULL 值
- 当数据表的字段都定义成 NOT NULL 的时候，这时候表里的行格式就不会有 NULL 值列表了
- 所以在设计数据库表的时候，通常都是建议将字段设置为  NOT NULL，这样可以至少节省 1 字节的空间（NULL 值列表至少占用 1 字节空间）。

#### 记录头信息
- delete_mask ：标识此条数据是否被删除。从这里可以知道，我们执行 detele 删除记录的时候，并不会真正的删除记录，只是将这个记录的 delete_mask 标记为 1。
- next_record：下一条记录的位置。从这里可以知道，记录与记录之间是通过链表组织的。在前面我也提到了，指向的是下一条记录的「记录头信息」和「真实数据」之间的位置，这样的好处是向左读就是记录头信息，向右读就是真实数据，比较方便。
- record_type：表示当前记录的类型，0表示普通记录，1表示B+树非叶子节点记录，2表示最小记录，3表示最大记录

######  三个隐藏字段 row_id trx_id roll_pointer
- row_id
- 如果我们建表的时候指定了主键或者唯一约束列，那么就没有 row_id 隐藏字段了。如果既没有指定主键，又没有唯一约束，那么 InnoDB 就会为记录添加 row_id 隐藏字段。row_id不是必需的，占用 6 个字节。
- trx_id
- 事务id，表示这个数据是由哪个事务生成的。 trx_id是必需的，占用 6 个字节。
- roll_pointer
- 这条记录上一个版本的指针。roll_pointer 是必需的，占用 7 个字节。
